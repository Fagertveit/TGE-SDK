var TGE=TGE||{};TGE.log=function(){if(window.console){window.console.log(Array.prototype.slice.call(arguments))}};function extend(d,b){var a=d.prototype;var c=function(){};c.prototype=b.prototype;d.prototype=new c();d.prototype.constructor=d;d.superclass=b.prototype;if(b.prototype.constructor===Object.prototype.constructor){b.prototype.constructor=b}for(var e in a){if(a.hasOwnProperty(e)){d.prototype[e]=a[e]}}}if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),d=this,b=function(){},c=function(){return d.apply(this instanceof b&&a?this:a,e.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;c.prototype=new b();return c}}window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}})();function getElementPosition(b){var c=b;var d="";var a=0;var e=0;if(c==null){return null}while((typeof(c)=="object")&&(typeof(c.tagName)!="undefined")){e+=c.offsetTop;a+=c.offsetLeft;d=c.tagName.toUpperCase();if(d=="BODY"){c=0}if(typeof(c)=="object"){if(typeof(c.offsetParent)=="object"){c=c.offsetParent}}if(c==null){return null}}return{x:a,y:e}}TGE.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"an unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.platform=this.searchString(this.dataPlatform)||"an unknown OS or Device";this.OSversion=this.detectOSversion(this.platform);this.isMobileDevice=!(this.platform==="Windows"||this.platform==="Mac")},detectOSversion:function(b){var e="-1";var d="";var a=navigator.userAgent.toString();switch(b){case"Windows Phone":d=/Windows Phone OS\s+[\d\.]+/;e=String(a.match(d)).substring(17,20);break;case"iPhone":case"iPad":d=/OS\s+[\d\_]+/;e=String(a.match(d)).substring(3,6);break;case"Windows":d=/Windows NT\s+[\d\.]+/;var c=String(a.match(d)).substring(11,14);if(c=="6.1"){e="7"}else{if(c=="5.1"){e="XP"}else{if(c=="5.2"){e="XP"}else{if(c=="6.0"){e="Vista"}else{if(c=="5.01"){e="2000 SP1"}else{if(c=="5.0"){e="2000"}}}}}}break;case"Mac":d=/Mac OS X\s+[\d\_]+/;e=String(a.match(d)).substring(9,13);break;case"Android":d=/ndroid\s+[\d\.]+/;e=String(a.match(d)).substring(7,10);break}return e},searchString:function(d){for(var a=0;a<d.length;a++){if(d[a]!=null){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!==-1){return d[a].identity}}else{if(c){return d[a].identity}}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a===-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Silk",identity:"Silk",versionSearch:"Silk"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.vendor,subString:"BlackBerry",identity:"BlackBerry"}],dataPlatform:[{string:navigator.platform,subString:"Windows Phone",identity:"Windows Phone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"Silk",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};TGE.BrowserDetect.init();TGE.Matrix=function(h,f,k,j,g,e){h=typeof h!=="undefined"?h:1;f=typeof f!=="undefined"?f:0;k=typeof k!=="undefined"?k:0;j=typeof j!=="undefined"?j:1;g=typeof g!=="undefined"?g:0;e=typeof e!=="undefined"?e:0;this._internal=[h,k,g,f,j,e,0,0,1]};TGE.Matrix.RotationMatrix=function(b){var a=new TGE.Matrix();a._internal[0]=Math.cos(b);a._internal[1]=-Math.sin(b);a._internal[3]=Math.sin(b);a._internal[4]=Math.cos(b);return a};TGE.Matrix.ScaleMatrix=function(b,a){return new TGE.Matrix().scale(b,a)};TGE.Matrix.TranslationMatrix=function(b,a){return new TGE.Matrix().translate(b,a)};TGE.Matrix.prototype={_internal:null,identity:function(){var a=this._internal;a[1]=a[2]=a[3]=a[5]=a[6]=a[7]=0;a[0]=a[4]=a[8]=1;return this},copyFrom:function(b){var a=this._internal;var c=b._internal;a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];return this},concat:function(m){var l=this._internal;var k=m._internal;var j=l[0]*k[0]+l[1]*k[3]+l[2]*k[6];var h=l[0]*k[1]+l[1]*k[4]+l[2]*k[7];var g=l[0]*k[2]+l[1]*k[5]+l[2]*k[8];var f=l[3]*k[0]+l[4]*k[3]+l[5]*k[6];var e=l[3]*k[1]+l[4]*k[4]+l[5]*k[7];var d=l[3]*k[2]+l[4]*k[5]+l[5]*k[8];var c=l[6]*k[0]+l[7]*k[3]+l[8]*k[6];var b=l[6]*k[1]+l[7]*k[4]+l[8]*k[7];var a=l[6]*k[2]+l[7]*k[5]+l[8]*k[8];l[0]=j;l[1]=h;l[2]=g;l[3]=f;l[4]=e;l[5]=d;l[6]=c;l[7]=b;l[8]=a;return this},rotate:function(a){return this.concat(TGE.Matrix.RotationMatrix(a*TGE.DEG2RAD))},scale:function(c,b){var a=this._internal;a[0]*=c;a[1]*=b;a[3]*=c;a[4]*=b;return this},translate:function(b,a){this._internal[2]+=b;this._internal[5]+=a;return this},transformPoint:function(b){var a=b.x;var c=b.y;b.x=a*this._internal[0]+c*this._internal[1]+this._internal[2];b.y=a*this._internal[3]+c*this._internal[4]+this._internal[5];return b}};TGE.Point=function(a,b){a=typeof a!=="undefined"?a:0;b=typeof b!=="undefined"?b:0;this.x=a;this.y=b;return this};TGE.Point.prototype={setTo:function(a,b){this.x=a;this.y=b},copyFrom:function(a){this.x=a.x;this.y=a.y;return this},add:function(a){return new this.constructor(this.x+a.x,this.y+a.y)},subtract:function(a){return new this.constructor(this.x-a.x,this.y-a.y)},offset:function(b,a){this.x+=b;this.y+=a;return this},rotate:function(b){var a=b*TGE.DEG2RAD;return new this.constructor(this.x*Math.cos(a)-this.y*Math.sin(a),this.y*Math.cos(a)+this.x*Math.sin(a))},rotateThis:function(d){var c=d*TGE.DEG2RAD;var a=this.x*Math.cos(c)-this.y*Math.sin(c);var b=this.y*Math.cos(c)+this.x*Math.sin(c);this.setTo(a,b);return this}};TGE.Vector2D=function(a,b){TGE.Vector2D.superclass.constructor.call(this,a,b)};TGE.Vector2D.prototype={magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dotProduct:function(a){return this.x*a.x+this.y*a.y},crossProduct:function(a){return this.x*a.y-this.y*a.x},angleBetween:function(a){var b=this.magnitude()*a.magnitude();if(b===0){return 0}return Math.acos(this.dotProduct(a)/b)*TGE.RAD2DEG}};extend(TGE.Vector2D,TGE.Point);TGE.Rectangle=function(b,d,c,a){b=typeof b!=="undefined"?b:0;d=typeof d!=="undefined"?d:0;c=typeof c!=="undefined"?c:0;a=typeof a!=="undefined"?a:0;this.x=b;this.y=d;this.width=c;this.height=a};TGE.Rectangle.prototype={intersects:function(h,l,j){l=typeof l==="undefined"?1:l;j=typeof j==="undefined"?1:j;var n=this.width*(1-l)/2;var m=this.height*(1-l)/2;var k=this.x+n;var g=this.y+m;var d=this.x+this.width-n;var c=this.y+this.height-m;n=h.width*(1-j)/2;m=h.height*(1-j)/2;var f=h.x+n;var e=h.y+m;var b=h.x+h.width-n;var a=h.y+h.height-m;if(f>=k&&b<=d&&e>=g&&a<=c){return true}if((d<f||k>b)||(c<e||g>a)){return false}return true},union:function(a){var g=this.x+this.width;var f=this.y+this.height;var c=a.x+a.width;var b=a.y+a.height;this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);var e=Math.max(g,c);var d=Math.max(f,b);this.width=e-this.x;this.height=d-this.y}};TGE.RAD2DEG=57.2957795;TGE.DEG2RAD=0.0174532925;TGE.POSITIVE_X_VECTOR=new TGE.Vector2D(1,0);TGE.NEGATIVE_X_VECTOR=new TGE.Vector2D(-1,0);TGE.POSITIVE_Y_VECTOR=new TGE.Vector2D(0,1);TGE.NEGATIVE_Y_VECTOR=new TGE.Vector2D(0,-1);TGE.DisplayObject=function(){this.x=0;this.y=0;this.scaleX=1;this.scaleY=1;this.rotation=0;this.alpha=1;this.backgroundColor=null;this.visible=true;this.width=0;this.height=0;this.registrationX=0.5;this.registrationY=0.5;this.parent=null;this.stage=null;this.mouseEnabled=false;this.instanceName="";this._mLocalTransform=new TGE.Matrix();this._mLocalTransformNoReg=new TGE.Matrix();this._mWorldTransform=new TGE.Matrix();this._mWorldTransformNoReg=new TGE.Matrix();this._mRegistrationTransform=new TGE.Matrix();this._mTopLeft=new TGE.Point();this._mBottomRight=new TGE.Point();this._mAABB=new TGE.Rectangle();this._boundingInfoDirty=true;return this};TGE.DisplayObject.prototype={_mPreviousX:0,_mPreviousY:0,_mPreviousScaleX:1,_mPreviousScaleY:1,_mPreviousRotation:0,_mPreviousRegistrationX:0,_mPreviousRegistrationY:0,_mPreviousVisibility:false,_mLocalTransform:null,_mLocalTransformNoReg:null,_mLocalTransformDirty:true,_mWorldTransform:null,_mWorldTransformNoReg:null,_mWorldTransformDirty:true,_mRegistrationTransform:null,_mTopLeft:0,_mBottomRight:0,_mAABB:null,_boundingInfoDirty:true,_mWorldAlpha:1,_mIgnoreProperties:false,_mMouseOver:false,_visibilityChanged:false,setLocalTransform:function(j,g,l,k,h,f){var e=this._mLocalTransform._internal;e[0]=j;e[1]=l;e[2]=h;e[3]=g;e[4]=k;e[5]=f;this._mIgnoreProperties=true;this._mLocalTransformDirty=true},useDisplayProperties:function(){this._mIgnoreProperties=false;this._mLocalTransformDirty=true},getBounds:function(){this._checkVisibilityChange();if(this._boundingInfoDirty){this._updateAABB()}return this._mAABB},hitTestPoint:function(a,f){var c=this.x-(this.registrationX*this.width);var b=this.x+((1-this.registrationX)*this.width);var e=this.y-(this.registrationY*this.height);var d=this.y+((1-this.registrationY)*this.height);return(a>this.x-(this.registrationX*this.width))&&(a<this.x+((1-this.registrationX)*this.width))&&(f>this.y-(this.registrationY*this.height))&&(f<this.y+((1-this.registrationY)*this.height))},clearChildren:function(){},markForRemoval:function(){},numChildren:function(a){return 0},_draw:function(b){this._checkVisibilityChange();if(!this.visible){return}this._updateTransformations();if(this.stage!==null&&this.mouseEnabled){this.stage._mMouseTargets.push(this)}b.save();var a=this._mWorldTransform._internal;if(this._mIgnoreProperties||this.rotation!==0){b.setTransform(a[0],a[3],a[1],a[4],a[2],a[5])}else{b.setTransform(a[0],a[3],a[1],a[4],a[2]|0,a[5]|0)}b.globalAlpha=this._mWorldAlpha;if(this.backgroundColor!==null){b.fillStyle=this.backgroundColor;b.fillRect(0,0,this.width,this.height)}this._drawClass(b);b.restore()},_drawClass:function(a){},_updateTransformations:function(){this._mWorldTransformDirty=false;var c=this.x!==this._mPreviousX||this.y!==this._mPreviousY||this.scaleX!==this._mPreviousScaleX||this.scaleY!==this._mPreviousScaleY||this.rotation!==this._mPreviousRotation||this._visibilityChanged;if(c&&!this._mIgnoreProperties){this._visibilityChanged=false;this._mPreviousX=this.x;this._mPreviousY=this.y;this._mPreviousScaleX=this.scaleX;this._mPreviousScaleY=this.scaleY;this._mPreviousRotation=this.rotation;this._mLocalTransformDirty=true}if(this.registrationX!==this._mPreviousRegistrationX||this.registrationY!==this._mPreviousRegistrationY){this._mPreviousRegistrationX=this.registrationX;this._mPreviousRegistrationY=this.registrationY;var b=-this.width*this.registrationX;var d=-this.height*this.registrationY;this._mRegistrationTransform.identity();this._mRegistrationTransform.translate(b,d)}if(this._mLocalTransformDirty){if(!this._mIgnoreProperties){this._mLocalTransform.identity();var a=this._mLocalTransform._internal;a[2]=this.x;a[5]=this.y;if(this.rotation!==0){this._mLocalTransform.rotate(this.rotation)}if(this.scaleX!==1||this.scaleY!==1){a[0]*=this.scaleX;a[1]*=this.scaleY;a[3]*=this.scaleX;a[4]*=this.scaleY}}this._mLocalTransformNoReg.copyFrom(this._mLocalTransform);this._mLocalTransform.concat(this._mRegistrationTransform)}if(this.parent!==null){if(this._mLocalTransformDirty||this.parent._mWorldTransformDirty){this._mWorldTransform.copyFrom(this.parent._mWorldTransformNoReg);this._mWorldTransform.concat(this._mLocalTransform);this._mWorldTransformNoReg.copyFrom(this.parent._mWorldTransformNoReg);this._mWorldTransformNoReg.concat(this._mLocalTransformNoReg);this._mWorldTransformDirty=true}}else{this._mWorldTransform.copyFrom(this._mLocalTransform);this._mWorldTransformDirty=this._mLocalTransformDirty}if(this._mWorldTransformDirty){this._setBoundingInfoDirty()}this._mWorldAlpha=this.parent!==null?this.parent._mWorldAlpha*this.alpha:this.alpha;this._mLocalTransformDirty=false},_updateAABB:function(){this._mTopLeft.x=0;this._mTopLeft.y=0;this._mBottomRight.x=this.width;this._mBottomRight.y=this.height;this._mWorldTransform.transformPoint(this._mTopLeft);this._mWorldTransform.transformPoint(this._mBottomRight);var a=Math.min(this._mTopLeft.x,this._mBottomRight.x);var c=Math.max(this._mTopLeft.x,this._mBottomRight.x);var d=Math.min(this._mTopLeft.y,this._mBottomRight.y);var b=Math.max(this._mTopLeft.y,this._mBottomRight.y);this._mAABB.x=a;this._mAABB.y=d;this._mAABB.width=c-a;this._mAABB.height=b-d;this._boundingInfoDirty=false},_setBoundingInfoDirty:function(){this._boundingInfoDirty=true;if(this.parent!==null){this.parent._setBoundingInfoDirty()}},_checkVisibilityChange:function(){if(this.visible!==this._mPreviousVisibility){this._visibilityChanged=true;this._mPreviousVisibility=this.visible;this._setBoundingInfoDirty()}}};TGE.DisplayObjectContainer=function(){TGE.DisplayObjectContainer.superclass.constructor.call(this);this._mChildren=[];return this};TGE.DisplayObjectContainer.prototype={_mChildren:null,addChild:function(a){if(a.parent!==null){a.parent.removeChild(a)}a.parent=this;a.stage=this.stage;this._mChildren.push(a);return a},getChildAt:function(a){return this._mChildren[a]},getChildByName:function(c,b){b=typeof b==="undefined"?false:b;var a=this._mChildren.length;for(var d=0;d<a;d++){if(this._mChildren[d].instanceName===c){return this._mChildren[d]}if(b){var e=this._mChildren[d].getChildByName(c,true);if(e!==null){return e}}}return null},getChildIndex:function(c){var a=this._mChildren.length;for(var b=0;b<a;b++){if(this._mChildren[b]===c){return b}}return -1},removeChild:function(b){var a=this.getChildIndex(b);if(a!==-1){this._mChildren[a].parent=null;this._mChildren.splice(a,1)}return b},clearChildren:function(){for(var a=this._mChildren.length-1;a>=0;a--){this._mChildren[a].markForRemoval();this._mChildren[a].clearChildren();this._mChildren[a].parent=null;this._mChildren.splice(a,1)}this._mChildren=[]},numChildren:function(a){a=typeof a==="undefined"?false:a;var d=this._mChildren.length;if(a){var c=0;for(var b=0;b<d;b++){c+=1+this._mChildren[b].numChildren(true)}return c}return d},_drawClass:function(b){TGE.DisplayObjectContainer.superclass._drawClass.call(this,b);var a=this._mChildren.length;for(var c=0;c<a;c++){var d=this._mChildren[c];d._checkVisibilityChange();if(d.visible){b.save();d._draw(b);b.restore()}}},_updateAABB:function(){TGE.DisplayObjectContainer.superclass._updateAABB.call(this);var a=this._mChildren.length;for(var b=0;b<a;b++){if(this._mChildren[b].visible){this._mAABB.union(this._mChildren[b].getBounds())}}}};extend(TGE.DisplayObjectContainer,TGE.DisplayObject);TGE.Stage=function(c,d){TGE.Stage.superclass.constructor.call(this);this.stage=this;this.assetManager=d;var a=false;if(c){if(c instanceof HTMLDivElement){a=false}else{if(c instanceof HTMLCanvasElement){a=true}else{c=document.body}}}var b;if(a){b=c}else{b=document.createElement("canvas");c.appendChild(b)}this.width=c.clientWidth;this.height=c.clientHeight;this.registrationX=0;this.registrationY=0;b.width=this.width;b.height=this.height;this._mCanvasContext=b.getContext("2d");return this};TGE.Stage.prototype={_mCanvasContext:null,_mMouseTargets:[],draw:function(){this._mMouseTargets=[];this._mCanvasContext.globalAlpha=1;this._mCanvasContext.globalCompositeOperation="source-over";this._draw.call(this,this._mCanvasContext)},_notifyObjectsOfMouseEvent:function(d,c,a){for(var b=this._mMouseTargets.length-1;b>=0;b--){var e=this._mMouseTargets[b];if(e.hitTestPoint(c,a)){if(true){switch(d){case"up":e.MouseUp();break;case"down":e.MouseDown();break;case"click":e.Click();break}return}}}},_updateObjectMouseOverStates:function(c,a){for(var b=this._mMouseTargets.length-1;b>=0;b--){var e=this._mMouseTargets[b];var d=e.hitTestPoint(c,a);if(d){e._mMouseOver=true}else{if(e._mMouseOver){e._mMouseOver=false}}}}};extend(TGE.Stage,TGE.DisplayObjectContainer);TGE.Sprite=function(){TGE.Sprite.superclass.constructor.call(this);return this};TGE.Sprite.prototype={_mImage:null,_mCellWidth:0,_mCellHeight:0,_mSpriteIndex:0,_mCoordinateCache:null,setImage:function(f,e,d){e=typeof e==="undefined"?1:e;d=typeof d==="undefined"?1:d;if(typeof f==="string"){f=TGE.AssetManager.GetImage(f)}if(f instanceof Image){this._mImage=f;this._mCellWidth=Math.floor(f.width/d);this._mCellHeight=Math.floor(f.height/e);this._mCoordinateCache=[];var b,a;for(var c=0;c<e*d;c++){b=((c%d)|0)*this._mCellWidth;a=((c/d)|0)*this._mCellHeight;this._mCoordinateCache.push([b,a])}this.width=this._mCellWidth;this.height=this._mCellHeight}else{this._mImage=null}this._mSpriteIndex=0},setSpriteIndex:function(a){this._mSpriteIndex=a;if(this._mSpriteIndex>=this._mCoordinateCache.length){TGE.log("***** ERROR: Attempt to call TGE.Sprite.setSpriteIndex with an out of range index ("+a.toString()+")");this._mSpriteIndex=0}},_drawClass:function(a){if(this._mImage!==null&&(this.width!==this._mCellWidth||this.height!==this._mCellHeight)){TGE.log("***** ERROR: You cannot change the width or height properties of a TGE.Sprite object - use scaleX or scaleY instead");this.width=this._mCellWidth;this.height=this._mCellHeight}if(this._mImage!==null){a.drawImage(this._mImage,this._mCoordinateCache[this._mSpriteIndex][0]>>0,this._mCoordinateCache[this._mSpriteIndex][1]>>0,this.width,this.height,0,0,this.width,this.height)}TGE.Sprite.superclass._drawClass.call(this,a)}};extend(TGE.Sprite,TGE.DisplayObjectContainer);TGE.AudioLoader=function(h,d,g,c,e){var b=this;this.id=h;this.loader=null;this.forceHandler=null;this.audio=document.createElement("audio");this.audio.setAttribute("preload","auto");document.body.appendChild(this.audio);var f=document.createElement("source");f.setAttribute("src",d);this.audio.appendChild(f);var a=document.createElement("source");a.setAttribute("src",g);this.audio.appendChild(a);this.url=d;this.tags=c;this.priority=e;this.complete=false;this.pollCount=0;this.start=function(l){this.loader=l;if(this.isLimited()){var k=function(){this.audio.pause();this.audio.removeEventListener("play",this.forceHandler,false);this.complete=true;this.loader.onLoad(b)};this.forceHandler=k.bind(this);this.audio.addEventListener("play",this.forceHandler,false);this.audio.play()}else{var j=function(){this.audio.removeEventListener("loadedmetadata",this.forceHandler,false);this.complete=true;this.loader.onLoad(b)};this.forceHandler=j.bind(this);this.audio.addEventListener("loadedmetadata",this.forceHandler,false);this.audio.load()}};this.checkStatus=function(){if(this.audio.networkState===HTMLMediaElement.NETWORK_NO_SOURCE){this.loader.onError(b);return}if(this.pollCount>=5){this.loader.onTimeout(b);return}if(this.complete===true){this.loader.onLoad(b)}this.pollCount++};this.onTimeout=function(){this.loader.onTimeout(b)};this.getName=function(){return d}};TGE.AudioLoader.prototype.isLimited=function(){return(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad")};PxLoader.prototype.addAudio=function(f,e,d,a,b){var c=new TGE.AudioLoader(f,e,d,a,b);this.add(c);return c.audio};TGE.AudioManager=function(a){this.mAssetManager=a;this.mVolume=1;this.mMuted=false;this.mplayerManagerList=new Array()};TGE.AudioManager.prototype={Play:function(b){var a=null;if(b.id in this.mplayerManagerList){a=this.mplayerManagerList[b.id]}else{a=new TGE.PlayerManager(this);if(a.init(b)===false){return}this.mplayerManagerList[b.id]=a}a.playAudio(b)},Pause:function(b){if(b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.pauseAudio()}},Mute:function(){if(this.mMuted===true){return}this.mMuted=true;for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.muteAudio()}},Unmute:function(){if(this.mMuted===false){return}this.mMuted=false;for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.unmuteAudio()}},ToggleMute:function(){if(this.mMuted===true){this.Unmute()}else{this.Mute()}},StopAll:function(){for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.stopAudio()}},PauseAll:function(){for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.pauseAudio()}},ResumeAll:function(){for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.resumeAudio()}},isLoadAudio:function(){return this.mAssetManager.mLoadAudio}};TGE.PlayerManager=function(a){this.mAudioManager=a;this.nStartTime=0;this.nEndTime=-1;this.nLoop=0;this.callback=null;this.audioElement=null;this.bPlaySegment=false;this.STATE={NotLoaded:0,Playing:1,Stopped:2,Paused:3,AutoPaused:4};this.mState=this.STATE.NotLoaded;this.audioId=null;this.audioPlaybackInProgressHandler=null;this.audioPlaybackCompleteHandler=null};TGE.PlayerManager.prototype={init:function(b){this.mState=this.STATE.NotLoaded;this.audioId=b.id;var d=this;this.callback=(b.callBackFunction!==undefined?b.callBackFunction:null);this.audioElement=this.mAudioManager.mAssetManager.getImage(b.id);if(undefined===this.audioElement){TGE.log("Unknown audio id: "+b.id);return false}this.nStartTime=0;this.nEndTime=-1;if("audio_sprite"===this.audioElement.assetType){this.bPlaySegment=true;this.nStartTime=this.audioElement.startTime;this.nEndTime=this.audioElement.endTime;this.audioElement=this.mAudioManager.mAssetManager.getImage(this.audioElement.id)}if(this.audioElement.canPlayType){}else{TGE.log("No canPlayType attribute found in audio tag: "+b.id);return false}this.nLoop=0;if(b.loop!==undefined){this.nLoop=Number(b.loop)}if(this.nLoop===undefined){this.nLoop=0}var c=function(){if(this.bPlaySegment){if(this.audioElement.currentTime<this.nStartTime){this.audioElement.currentTime=this.nStartTime}if(this.audioElement.currentTime>=this.nEndTime){if(this.nLoop===0){this.stopAudio()}else{this.restartAudio()}}}};var a=function(){if(this.nLoop===0){this.stopAudio()}else{this.restartAudio()}};this.audioElement.addEventListener("timeupdate",c.bind(this),false);this.audioElement.addEventListener("ended",a.bind(this),false);window.addEventListener("pagehide",function(){if(d.mState===d.STATE.Playing){d.pauseAudio();d.mState=d.STATE.AutoPaused}});window.addEventListener("pageshow",function(){if(d.mState===d.STATE.AutoPaused){d.resumeAudio()}});this.mState=this.STATE.Stopped;return true},playAudio:function(a){if(this.mAudioManager.isLoadAudio()===false){return}if(this.mAudioManager.mMuted===true){this.audioElement.volume=0}else{this.audioElement.volume=this.mAudioManager.mVolume}try{this.audioElement.currentTime=this.nStartTime}catch(b){TGE.log("Error setting start time, continuing: "+b)}if(this.bPlaySegment===false){this.nEndTime=this.audioElement.duration}this.mState=this.STATE.Playing;this.audioElement.play()},stopAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.mState=this.STATE.Stopped;this.audioElement.pause();this.audioElement.currentTime=0;if(this.callback!==null){this.callback()}},restartAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.mState=this.STATE.Playing;this.audioElement.currentTime=this.nStartTime;this.audioElement.play()},pauseAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}if(this.mState!==this.STATE.Playing){return}this.mState=this.STATE.Paused;this.audioElement.pause()},resumeAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}if(this.mState!==this.STATE.Paused){return}this.mState=this.STATE.Playing;this.audioElement.play()},muteAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.audioElement.volume=0},unmuteAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.audioElement.volume=this.mAudioManager.mVolume},};TGE.Game=function(){this.mCanvasDiv=null;this.mReorientationDiv=null;this.mCorrectOrientation="unspecified";this.mCanvasPosition=null;this.mGameManager=new TGE.ObjectsManager();this.mLayers={};this.mCameraLocation=null;this.mScalingFactor=1;this.mLoadingStartTime=new Date().getTime();this.mLoadingScreen=null;this.stage=null;this.assetManager=new TGE.AssetManager();this.audioManager=new TGE.AudioManager(this.assetManager);this.mPlaying=false;this.mPaused=false;this.mCurrentLevel=null;this.mPauseButton=null;this.mUserPauseEnabled=false;this.mGameTime=0;this.mFilterStrength=10;this.mFrameTime=0;this.mLastLoop=new Date;this.mLastDisplay=new Date;this.mThisLoop;this.mFPSText=null;this.mMaxTickTime=0.1;this.mMinTickTime=Number.MIN_VALUE;this.mUIManager=new TGE.ObjectsManager();this.mScreenManager=new TGE.ScreenManager(this);this.mMouseX=0;this.mMouseY=0;this.mMouseDown=false;this.mKeysDown={};this.mDefaultLinkTarget="_blank";this.mButtonClickEvent="mousedown"};TGE.Game.prototype={IsPlatformAcceptable:function(){var d=false;if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var a=TGE.BrowserDetect.OSversion.charCodeAt(0)-48;return a>=5}if(TGE.BrowserDetect.Platform==="Android"){return true}if(TGE.BrowserDetect.platform==="Windows"||TGE.BrowserDetect.platform==="Mac"){var c=TGE.BrowserDetect.browser.toLowerCase();var b=parseFloat(TGE.BrowserDetect.version);if(c=="firefox"){return b>=8}else{if(c=="explorer"){return b>=9}else{if(c=="chrome"){return b>=14}else{if(c=="safari"){return b>=5.1}else{}}}}}return true},DetermineCanvasPosition:function(){this.mCanvasPosition=getElementPosition(this.mCanvasDiv)},Launch:function(d,c){var b;var a;if(typeof d==="string"){b=d;a=c;this.mCorrectOrientation="landscape"}else{b=typeof d.gameDiv==="undefined"?null:d.gameDiv;a=typeof d.reorientDiv==="undefined"?null:d.reorientDiv;this.mCorrectOrientation=typeof d.orientation==="undefined"?"unspecified":d.orientation}this.mCanvasDiv=document.getElementById(b);if(this.mCanvasDiv==null){console.log("***** ERROR: Could not find canvas div '"+b+"'");return false}this.ResizeViewportForDevice();this.mReorientationDiv=document.getElementById(a);this.DetermineCanvasPosition();window.addEventListener("resize",this.DetermineCanvasPosition.bind(this),false);this.mCanvasDiv.addEventListener("click",this._preventBehavior.bind(this),false);this.mCanvasDiv.addEventListener("mousedown",this.MouseDown.bind(this),false);this.mCanvasDiv.addEventListener("mouseup",this.MouseUp.bind(this),false);this.mCanvasDiv.addEventListener("mousemove",this.MouseMove.bind(this),false);this.mCanvasDiv.addEventListener("mouseover",this.MouseOver.bind(this),false);this.mCanvasDiv.addEventListener("mouseout",this.MouseOut.bind(this),false);this.mCanvasDiv.addEventListener("touchstart",this.touchHandler.bind(this),true);this.mCanvasDiv.addEventListener("touchmove",this.touchHandler.bind(this),true);this.mCanvasDiv.addEventListener("touchend",this.touchHandler.bind(this),true);this.mCanvasDiv.addEventListener("touchcancel",this.touchHandler.bind(this),true);document.addEventListener("keydown",this._keyDown.bind(this),false);document.addEventListener("keyup",this._keyUp.bind(this),false);this.InitializeRenderer();this.mDeviceOrientation=new TGE.DeviceOrientation();this.mDeviceOrientation.RegisterOrientationChange(this.OrientationChanged.bind(this));this.BeginLoad();return true},ResizeViewportForDevice:function(){viewport=document.querySelector("meta[name=viewport]");switch(TGE.BrowserDetect.platform){case"iPhone":if(this.mCanvasDiv.clientWidth==960||this.mCanvasDiv.clientWidth==640){viewport.setAttribute("content","width=device-width, maximum-scale=0.5, minimum-scale=0.5,initial-scale=0.5, user-scalable=no")}else{viewport.setAttribute("content","width=device-width, maximum-scale=1.0, minimum-scale=1.0,initial-scale=1.0, user-scalable=no")}break;case"iPad":if(parseInt(window.innerWidth)>1000){viewport.setAttribute("content","width=device-width; maximum-scale=2.0; minimum-scale=2.0,initial-scale=2.0,user-scalable=no")}else{viewport.setAttribute("content","width=device-width; maximum-scale=1.07; minimum-scale=1.07,initial-scale=1.07,user-scalable=no")}break;case"Android":this.mDefaultLinkTarget="_self";if(TGE.BrowserDetect.browser=="Chrome"){var d=1;if(this.mCorrectOrientation==="landscape"){var b=Math.min(window.outerWidth,window.outerHeight);d=Math.round((b/this.mCanvasDiv.clientHeight)*100)/100}else{if(this.mCorrectOrientation==="portrait"){var a=Math.min(window.outerWidth,window.outerHeight);d=Math.round((a/this.mCanvasDiv.clientWidth)*100)/100}}viewport.setAttribute("content","width=device-width, maximum-scale="+d+", minimum-scale="+d+", initial-scale="+d+", user-scalable=no");var c=document.getElementById("viewporter");if(c!==null){c.align="left"}}else{if(TGE.BrowserDetect.browser=="Mozilla"){if(this.mCorrectOrientation==="landscape"){viewport.setAttribute("content","target-densitydpi=device-dpi, width="+this.mCanvasDiv.clientHeight)}else{if(this.mCorrectOrientation==="portrait"){viewport.setAttribute("content","target-densitydpi=device-dpi, width="+this.mCanvasDiv.clientWidth)}}}}break;case"Kindle Fire":if(this.mCorrectOrientation==="landscape"){viewport.setAttribute("content","target-densitydpi=device-dpi, width="+this.mCanvasDiv.clientHeight)}else{if(this.mCorrectOrientation==="portrait"){viewport.setAttribute("content","target-densitydpi=device-dpi, width="+this.mCanvasDiv.clientWidth)}}break;case"Windows":case"Mac":this.mButtonClickEvent="click";break;default:viewport.setAttribute("content","width=device-width, maximum-scale=1, minimum-scale=1, initial-scale=1,user-scalable=no");break}if(window.navigator.standalone==true){switch(TGE.BrowserDetect.platform){case"iPhone":viewport.setAttribute("content","width=device-width, height=device-height, maximum-scale=0.50, minimum-scale=0.50,initial-scale=0.50, user-scalable=no");break;case"iPad":viewport.setAttribute("content","width=device-width; maximum-scale=1.07; minimum-scale=1.07,initial-scale=1.07,user-scalable=no");break}}},InitializeRenderer:function(){this.stage=new TGE.Stage(this.mCanvasDiv,this.assetManager)},OrientationChanged:function(a){if(!TGE.BrowserDetect.isMobileDevice||this.mReorientationDiv==null||this.mCorrectOrientation==="unspecified"){return}if(a!==this.mCorrectOrientation){this.mCanvasDiv.style.display="none";this.mReorientationDiv.style.display="block";this.PauseGame(true)}else{this.mReorientationDiv.style.display="none";this.mCanvasDiv.style.display="block";this.ResizeViewportForDevice()}},BeginLoad:function(){this.assetManager.loadAssetList("loading",null,this.LoadRequiredAssets.bind(this))},LoadRequiredAssets:function(){this.mScreenManager.Initialize(this);var a=null;if(typeof(LoadingScreen)!="undefined"){this.mLoadingScreen=this.ShowScreen(LoadingScreen);a=this.loadRequiredAssetsCallback.bind(this)}this.Update();this.assetManager.loadAssetList("required",a,this.finishedLoadingRequiredAssets.bind(this))},loadRequiredAssetsCallback:function(a){if(this.mLoadingScreen!=null&&typeof(this.mLoadingScreen.UpdateProgress)=="function"){this.mLoadingScreen.UpdateProgress(a)}},finishedLoadingRequiredAssets:function(){var a=Math.round((new Date().getTime()-this.mLoadingStartTime)/1000);this.AnalyticGameEvent("load",a);this.GotoMainMenu()},LoadLevelAssets:function(c,b,a){this.assetManager.loadAssetList("level_"+c.toString(),b,a)},StartLevel:function(a){var b=a==this.mCurrentLevel;this.mCurrentLevel=a;this.subclassSetupLevel(this.mCurrentLevel);this.AnalyticLevelEvent(b?"replay":"start");if(!this.mPlaying||this.mPaused){this.StartPlaying()}},FinishLevel:function(){this.AnalyticLevelEvent("complete");this.subclassFinishLevel()},Replay:function(){this.StartLevel(this.mCurrentLevel)},StartPlaying:function(){this.mGameTime=0;this.mPaused=false;this.mPlaying=true;this.subclassStartPlaying()},ClearScene:function(){this.mGameManager.Purge();this.mUIManager.Purge();this.mCameraLocation=new TGE.Point();this.stage.clearChildren();this.mFPSText=null;this.SetupLayers();this.mScreenManager.Initialize(this);this.CreateLayer("FPS");var b=this.assetManager.getImage("pause_button",false);if(b!=null&&b.width>0){var a=Math.max(b.width,b.height);this.mPauseButton=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.Width()-a/2,a/2,"pause_button","ScreenManager");this.EnableUserPause()}},SetupLayers:function(){this.mLayers={};this.CreateLayer("TGE_default");this.subclassSetupLayers()},ShowScreen:function(a){return this.mScreenManager.ShowScreen(a)},GotoMainMenu:function(){this.mPaused=false;this.mPlaying=false;this.ClearScene();if(typeof(MainMenu)!="undefined"){this.ShowScreen(MainMenu)}else{this.StartPlaying()}},PauseGame:function(a){if(!this.mPlaying||a==this.mPaused){return}this.mPaused=a;this.AnalyticGameEvent(this.mPaused?"pause":"resume",this.mCurrentLevel);this.DetermineCanvasPosition();if(typeof(PauseScreen)!="undefined"){if(this.mPaused){this.ShowScreen(PauseScreen,false);this.DisableUserPause()}else{this.mScreenManager.CloseScreen(PauseScreen);this.EnableUserPause()}}},DisableUserPause:function(){this.mUserPauseEnabled=false;if(this.mPauseButton!=null){this.mPauseButton.Hide()}},EnableUserPause:function(){this.mUserPauseEnabled=true;if(this.mPauseButton!=null){this.mPauseButton.Show()}},Update:function(){var a=(this.mThisLoop=new Date)-this.mLastLoop;this.mFrameTime+=(a-this.mFrameTime)/this.mFilterStrength;this.mLastLoop=this.mThisLoop;this.updateFPSDisplay();a=a/1000;a=Math.max(this.mMinTickTime,a);a=Math.min(this.mMaxTickTime,a);if(!this.mPaused){this.mGameTime+=a}this.mScreenManager.Update(a);this.stage._updateObjectMouseOverStates(this.mMouseX,this.mMouseY);if(!this.mPaused){this.updateObjects(a)}if(this.mPlaying&&!this.mPaused){this.subclassUpdateGame(a)}this._updateObjectsToScreen();requestAnimFrame(this.Update.bind(this));this.stage.draw()},SetConstantTickTime:function(a){this.mMinTickTime=this.mMaxTickTime=a},SetBackgroundColor:function(a){this.stage.backgroundColor=a},CreateLayer:function(a){var b=new TGE.DisplayObjectContainer();this.mLayers[a]=b;b.registrationX=0;b.registrationY=0;this.stage.addChild(b)},CreateWorldEntity:function(b){var a=new b;b.prototype.constructor.apply(a,[this]);this.mGameManager.AddObject(a);return a},CreateUIEntity:function(b){var a=new b;b.prototype.constructor.apply(a,[this]);this.mUIManager.AddObject(a);return a},getLayer:function(a){var b="TGE_default" in this.mLayers?this.mLayers.TGE_default:this.stage;if(a!=null&&a in this.mLayers){b=this.mLayers[a]}return b},ShowFramerateDisplay:function(a,d,c,b){if(this.mFPSText!=null){this.mFPSText.markForRemoval()}this.mFPSText=this.CreateUIEntity(TGE.Text).Setup(a,d,"",c.toString()+"px Arial","center","middle",b,"FPS")},updateFPSDisplay:function(){var a=this.mThisLoop-this.mLastDisplay;if(a<1000){return}this.mLastDisplay=this.mThisLoop;if(this.mFrameTime>0&&this.mFPSText!=null){this.mFPSText.Show();this.mFPSText.text=(Math.round(1000/this.mFrameTime).toFixed(0)+"fps")}},updateObjects:function(a){this.mGameManager.Update(a);this.mUIManager.Update(a)},_updateObjectsToScreen:function(){this.mGameManager._updateObjectsToScreen()},EndGame:function(){if(!this.mPlaying){return}this.mPlaying=false;var a=Math.round(this.mGameTime);this.AnalyticGameEvent("end",a);this.DisableUserPause();this.subclassEndGame();if(typeof(GameOver)!="undefined"){this.ShowScreen(GameOver)}},CurrentLevel:function(){return this.mCurrentLevel},_processMousePosition:function(a){if(this.mCanvasPosition===null){this.DetermineCanvasPosition()}this.mMouseX=(a.pageX-this.mCanvasPosition.x);this.mMouseY=(a.pageY-this.mCanvasPosition.y);if(!a){a=window.event}if(a.pageX||a.pageY){this.mMouseX=a.pageX;this.mMouseY=a.pageY}else{if(a.clientX||a.clientY){this.mMouseX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;this.mMouseY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}}this.mMouseX-=this.mCanvasPosition.x;this.mMouseY-=this.mCanvasPosition.y},_preventBehavior:function(a){a.preventDefault()},Click:function(a){a.preventDefault();this._processMousePosition(a);this.stage._notifyObjectsOfMouseEvent("click",this.mMouseX,this.mMouseY)},MouseMove:function(a){a.preventDefault();this._processMousePosition(a);if(!this.mPaused){this.subclassMouseMove()}},MouseDown:function(b){window.focus();b.preventDefault();this._processMousePosition(b);this.mMouseDown=true;if(this.mUserPauseEnabled&&this.mPauseButton!=null){var a=Math.max(this.mPauseButton.Width(),this.mPauseButton.Height());if(this.mMouseX>this.Width()-a&&this.mMouseY<a){this.PauseGame(true);return}}this.stage._notifyObjectsOfMouseEvent("down",this.mMouseX,this.mMouseY);if(!this.mPaused){this.subclassMouseDown()}},MouseUp:function(a){a.preventDefault();this._processMousePosition(a);this.mMouseDown=false;this.stage._notifyObjectsOfMouseEvent("up",this.mMouseX,this.mMouseY);if(!this.mPaused){this.subclassMouseUp()}},MouseOver:function(a){a.preventDefault()},MouseOut:function(a){a.preventDefault()},touchHandler:function(c){var d=c.changedTouches;var e=d[0];var a="";switch(c.type){case"touchstart":a="mousedown";break;case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var b=document.createEvent("MouseEvent");b.initMouseEvent(a,true,true,this.mCanvasDiv,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);this.mCanvasDiv.dispatchEvent(b);c.preventDefault()},MouseX:function(){return this.mMouseX},MouseY:function(){return this.mMouseY},IsMouseDown:function(){return this.mMouseDown},_keyDown:function(a){this.mKeysDown[a.keyCode]=true;this.subclassKeyDown(a.keyCode)},_keyUp:function(a){this.mKeysDown[a.keyCode]=false;this.subclassKeyUp(a.keyCode)},isKeyDown:function(a){return this.mKeysDown[a]===true},Width:function(){return this.stage.width},Height:function(){return this.stage.height},GameTime:function(){return this.mGameTime},NumGameObjects:function(){return this.mGameManager.NumObjects()},NumUIObjects:function(){return this.mUIManager.NumObjects()},CameraLocation:function(){return this.mCameraLocation},ScreenX:function(a){return(this.stage.width/2)+(a-this.mCameraLocation.x)},ScreenY:function(a){return(this.stage.height/2)-(a-this.mCameraLocation.y)},GetImage:function(a){return this.assetManager.getImage(a)},OpenURL:function(a){this.AnalyticClickThruEvent(a);window.open(a,this.mDefaultLinkTarget)},PlayGame:function(){this.AnalyticGameEvent("begin");this.subclassPlayGame()},CurrentScore:function(){return 0},subclassSetupLayers:function(){},subclassPlayGame:function(){this.StartLevel(-1)},subclassSetupLevel:function(a){},subclassStartPlaying:function(){},subclassStartLevel:function(){},subclassFinishLevel:function(){},subclassUpdateGame:function(a){},subclassEndGame:function(a){},subclassMouseMove:function(){},subclassMouseDown:function(){},subclassMouseUp:function(){},subclassKeyDown:function(a){},subclassKeyUp:function(a){},AnalyticGameEvent:function(a,b){if(this.mAnalytics!=null){this.mAnalytics.LogGameEvent(a,this.mCurrentLevel,b)}},AnalyticShareEvent:function(a){if(this.mAnalytics!=null){this.mAnalytics.LogShareEvent(a,this.mCurrentLevel)}},AnalyticLevelEvent:function(a){if(this.mAnalytics!=null){this.mAnalytics.LogLevelEvent(a,this.mCurrentLevel,Math.floor(this.mGameTime))}},AnalyticAchievementEvent:function(b,a){if(this.mAnalytics!=null){this.mAnalytics.LogAchievementEvent(b,this.mCurrentLevel,a)}},AnalyticClickThruEvent:function(a){if(this.mAnalytics!=null){this.mAnalytics.LogClickThruEvent(a,this.mCurrentLevel)}},AnalyticCustomEvent:function(a,c,b){if(this.mAnalytics!=null){this.mAnalytics.LogCustomEvent(a,this.mCurrentLevel,b)}}};TGE.KEY_ARROW_LEFT=37;TGE.KEY_ARROW_RIGHT=39;TGE.KEY_ARROW_UP=38;TGE.KEY_ARROW_DOWN=40;TGE.KEY_SPACEBAR=32;TGE.ObjectsManager=function(){this.mObjectsArray=[]};TGE.ObjectsManager.prototype={AddObject:function(a){this.mObjectsArray.push(a)},Update:function(a){for(var b=this.mObjectsArray.length-1;b>=0;b--){this.mObjectsArray[b].Update(a);if(this.mObjectsArray[b].MarkedForRemoval()){this.mObjectsArray[b].Cleanup();this.mObjectsArray.splice(b,1)}}},_updateObjectsToScreen:function(){for(var a=0;a<this.mObjectsArray.length;a++){this.mObjectsArray[a]._updateScreenPosition()}},Purge:function(){for(var a=this.mObjectsArray.length-1;a>=0;a--){this.mObjectsArray[a].Cleanup();this.mObjectsArray.splice(a,1)}},NumObjects:function(){return this.mObjectsArray.length}};TGE.AssetLoader=function(){this.mAssetList=null;this.mUpdateCallback=null;this.mCompleteCallback=null;return this};TGE.AssetLoader.prototype={loadAssetList:function(d,b,g,h,f){g=typeof g==="string"?g:"";if(g.length>0&&g.charAt(g.length-1)!=="/"){g=g.concat("/")}this.mAssetList=b;this.mUpdateCallback=h;this.mCompleteCallback=f;var a=new PxLoader();var e=0;if(b!==null&&b.loaded===false){for(i=0;i<b.list.length;i++){var c=null;if(b.list[i].assetType==="audio"){if(d.loadAudio){c=a.addAudio(b.list[i].id,g+b.list[i].url,g+b.list[i].backup_url,null,null);e++}}else{if(b.list[i].assetType==="audio_sprite"){c={assetType:"audio_sprite",id:b.list[i].sprite,startTime:b.list[i].startTime,endTime:b.list[i].endTime}}else{c=a.addImage(g+b.list[i].url)}}if(c!==null){d.addImage(b.list[i].id,c)}}a.addProgressListener(TGE.AssetLoader.prototype._loaderCallback.bind(this));a.addCompletionListener(TGE.AssetLoader.prototype._completeCallback.bind(this));a.start()}else{if(this.mUpdateCallback!==null){this.mUpdateCallback(1)}if(this.mCompleteCallback!==null){this.mCompleteCallback.call()}}},_loaderCallback:function(b){if(b.error){TGE.log("***** ERROR: could not load image '"+b.resource.getName()+"'")}if(this.mUpdateCallback!==null){var a=b.completedCount/b.totalCount;this.mUpdateCallback(a)}},_completeCallback:function(){if(this.mAssetList!==null){this.mAssetList.loaded=true;this.mAssetList=null}if(this.mCompleteCallback!==null){this.mCompleteCallback()}}};TGE.AssetManager=function(a){if(TGE.AssetManager.sAssetManagerInstance!==null){return TGE.AssetManager.sAssetManagerInstance}TGE.AssetManager.sAssetManagerInstance=this;if(a===undefined){a=true}this.rootLocation="";this.loadAudio=a;return this};TGE.AssetManager.sAssetManagerInstance=null;TGE.AssetManager.GetImage=function(a){return TGE.AssetManager.sAssetManagerInstance===null?null:TGE.AssetManager.sAssetManagerInstance.getImage(a)};TGE.AssetManager.prototype={_mImageAssetLists:[],_mImageCache:[],assignImageAssetList:function(b,a){this._mImageAssetLists[b]={loaded:false,list:a}},loadAssetList:function(b,d,c){var e=new TGE.AssetLoader();var a=this._mImageAssetLists[b];if(a){e.loadAssetList(this,a,this.rootLocation,d,c)}else{TGE.log("TGE.AssetManager could not locate asset list '"+b+"'");if(c){c.call()}}},addImage:function(b,a){this._mImageCache[b]=a},getImage:function(c,b){b=typeof b==="undefined"?true:b;var a=this._mImageCache[c];if(b&&c!=null&&!a){TGE.log("***** ERROR: TGE.AssetManager.getImage could not find the asset '"+c+"'")}return a}};TGE.SpriteAnimation=function(d,f,c,b,g,e,a){this.mFPS=e;this.mNumberOfFrames=g;this.mLooping=a;this.mAge=0;this.mPaused=false;this.mFinishedCallback=null;this.mFrameOffset=0;this.mCurrentFrame=0;this.mSprite=new TGE.Sprite();this.mSprite.setImage(f,c,b);this.mSprite.visible=false;d.addChild(this.mSprite);this.mSprite.registrationX=d.registrationX;this.mSprite.registrationY=d.registrationY};TGE.SpriteAnimation.prototype={Play:function(a){this.mAge=0;this.mFinishedCallback=a;this.mSprite.setSpriteIndex(0);this.mSprite.visible=true},Pause:function(){this.mPaused=true},Stop:function(){this.mSprite.visible=false},Resume:function(){this.mPaused=false},SetAnimationIndexOffset:function(a){this.mFrameOffset=a},Update:function(a){if(!this.mPaused){this.mAge+=a}var c=1/this.mFPS;var b=Math.floor(this.mAge/c);this.mCurrentFrame=0;if(this.mLooping||b<this.mNumberOfFrames){this.mCurrentFrame=b%this.mNumberOfFrames}else{this.mCurrentFrame=this.mNumberOfFrames-1;if(this.mFinishedCallback!=null){this.mFinishedCallback.call();this.mFinishedCallback=null}}this.mCurrentFrame+=this.mFrameOffset;this.mSprite.setSpriteIndex(this.mCurrentFrame)}};TGE.KeyframedAnimation=function(d,e,c,a,b){this.mAnimationPlayer=d;this.mAnimationID=e;this.mPartInstances=c;this.mLooping=a;this.mFinishedCallback=b;this.mSmoothTransitions=true;this.mAge=0;this.mPaused=false;if(!this.mAnimationPlayer.AnimationExists(e)){this.Cancel();console.log("***** ERROR: keyframed animation not found: '"+e+"'")}return this};TGE.KeyframedAnimation.prototype={Pause:function(){this.mPaused=true},Resume:function(){this.mPaused=false},Update:function(a){if(this.mPaused){return}this.mAge+=a;this.mAnimationPlayer.PosePartInstances(this.mPartInstances,this.mAnimationID,this.mAge,this.mSmoothTransitions)},Cancel:function(){this.mFinishedCallback=null;this.Pause()}};TGE.KeyframedAnimationPlayer=function(d,b,c){this.mData=null;this.mPartImages=null;if(d.parts===undefined||d.part_instances===undefined||d.animations===undefined||d.max_children===undefined||d.framerate===undefined){return this}this.mData=d;this.mInverseGlobalScale=1/d.image_scale;if(b){if(typeof(c)==="undefined"){c=""}for(var a in this.mData.parts){if(this.mData.parts.hasOwnProperty(a)){b.push({id:a,url:(c+"/"+a+".png")})}}}return this};TGE.KeyframedAnimationPlayer.prototype={Valid:function(){return this.mData!==null},GetAnimations:function(){return this.Valid()?this.mData.animations:null},NumRequiredPartInstances:function(){return this.Valid()?this.mData.max_children:0},AnimationExists:function(a){return this.Valid()?this.mData.animations[a]!==undefined:false},InitializeImages:function(a){if(this.mPartImages!==null){return}this.mPartImages={};for(var b in this.mData.parts){if(this.mData.parts.hasOwnProperty(b)){this.mPartImages[b]=a.GetImage(b)}}},PosePartInstances:function(j,g,o,e){if(!this.Valid()){return}var A=this.mData.animations[g];var x=A.frames.length;var s=x/this.mData.framerate;var w=Math.floor(o/s);var y=((o-(w*s))/s)*x;var l=Math.floor(y);var k=A.frames[l];var u=(l+1)%x;var t=A.frames[u];var z=j.length;var q=k.instances.length;for(var r=0;r<z;r++){var m=j[r];if(r>=q){m.visible=false}else{var C=k.instances[r];var f=this.mData.part_instances[C.i];var v=this.mData.parts[f];m.setImage(this.mPartImages[f]);m.registrationX=v.regx;m.registrationY=v.regy;var H=C.a;var F=C.b;var D=C.c;var B=C.d;var G=C.x;var E=C.y;if(e){var h=t.instances[t.instances_map[C.i]];if(h!==undefined){var n=y-l;H=C.a+(h.a-C.a)*n;F=C.b+(h.b-C.b)*n;D=C.c+(h.c-C.c)*n;B=C.d+(h.d-C.d)*n;G=C.x+(h.x-C.x)*n;E=C.y+(h.y-C.y)*n}}H*=this.mInverseGlobalScale;F*=this.mInverseGlobalScale;D*=this.mInverseGlobalScale;B*=this.mInverseGlobalScale;m.setLocalTransform(H,F,D,B,G,E);m.visible=true}}}};TGE.ScreenEntity=function(a){TGE.ScreenEntity.superclass.constructor.call(this);this.mGame=a;this.mAge=0;this.mMarkedForRemoval=false;this.mAnimations=[];this.mCurrentAnimation=null;this.mKeyframedAnimationPlayer=null;this.mAnimationPartInstances=[];this.mCurrentKeyframedAnimation=null};TGE.ScreenEntity.prototype={_mCameraCulling:null,Setup:function(b,d,c,a){this.mLayer=a;this.x=b;this.y=d;this.setImage(this.mGame.GetImage(c));this.mGame.getLayer(this.mLayer).addChild(this);return this},SetImage:function(b,c,a){var d=this.mGame.GetImage(b);if(d==null){return}c=typeof c!=="undefined"?c:1;a=typeof a!=="undefined"?a:1;this.setImage(d,c,a)},LoadAnimation:function(h,c,e,d,g,f,b){var a=new TGE.SpriteAnimation(this,this.mGame.GetImage(c),e,d,g,f,b);this.mAnimations[h]=a},PlayAnimation:function(b,a){if(this.mCurrentAnimation==this.mAnimations[b]){return}this.PlayAnimationFromStart(b,a)},PlayAnimationFromStart:function(c,a){var b=this.mAnimations[c];if(b!=null){if(this.mCurrentAnimation!==null){this.mCurrentAnimation.Stop()}this.setImage(null);this.mCurrentAnimation=b;this.mCurrentAnimation.Play(a);this.width=this.mCurrentAnimation.mSprite.width;this.height=this.mCurrentAnimation.mSprite.height}},InitializeKeyframedAnimations:function(c){this.mKeyframedAnimationPlayer=c;this.mKeyframedAnimationPlayer.InitializeImages(this.mGame);if(this.mCurrentKeyframedAnimation!==null){this.mCurrentKeyframedAnimation.Cancel()}if(this.mAnimationPartInstances.length>0){var b=this.mAnimationPartInstances.length;for(var e=0;e<b;e++){this.mAnimationPartInstances[e].markForRemoval()}}this.mAnimationPartInstances=[];var d=this.mKeyframedAnimationPlayer.NumRequiredPartInstances();for(var e=0;e<d;e++){var a=this.addChild(new TGE.Sprite());a.visible=false;this.mAnimationPartInstances.push(a)}},PlayKeyframedAnimation:function(c,a,b){if(typeof(a)==="undefined"){a=true}if(typeof(b)==="undefined"){b=null}if(this.mCurrentKeyframedAnimation!==null){this.mCurrentKeyframedAnimation.Cancel()}this.mCurrentKeyframedAnimation=new TGE.KeyframedAnimation(this.mKeyframedAnimationPlayer,c,this.mAnimationPartInstances,a,b)},Age:function(){return this.mAge},Update:function(a){this.mAge+=a;this.subclassUpdate(a);if(this.ShouldBeRemoved()){this.markForRemoval()}if(this.mCurrentAnimation!=null){this.mCurrentAnimation.Update(a)}if(this.mCurrentKeyframedAnimation!==null){this.mCurrentKeyframedAnimation.Update(a)}},Cleanup:function(){this.subclassCleanup();this.clearChildren();if(this.parent!==null){this.parent.removeChild(this)}},markForRemoval:function(){this.mMarkedForRemoval=true;var a=this._mChildren.length;for(var b=0;b<a;b++){this._mChildren[b].markForRemoval()}},MarkedForRemoval:function(){return this.mMarkedForRemoval},ShouldBeRemoved:function(){if(this._mCameraCulling!==null){var a=this.getBounds();if(this._mCameraCulling[0]&&a.y+a.height<0){return true}if(this._mCameraCulling[1]&&a.x>this.mGame.Width()){return true}if(this._mCameraCulling[2]&&a.y>this.mGame.Height()){return true}if(this._mCameraCulling[3]&&a.x+a.width<0){return true}}return this.subclassShouldBeRemoved()},subclassUpdate:function(a){},subclassShouldBeRemoved:function(){return false},subclassCleanup:function(){},_updateScreenPosition:function(){},SetRotation:function(a){this.rotation=a},SetScale:function(b,a){a=typeof a==="undefined"?b:a;this.scaleX=b;this.scaleY=a},SetAlpha:function(a){this.alpha=a},Width:function(){return this.width},Height:function(){return this.height},Show:function(){this.visible=true},Hide:function(){this.visible=false},Visible:function(){return this.visible}};extend(TGE.ScreenEntity,TGE.Sprite);TGE.Button=function(a){TGE.ScreenEntity.call(this,a);this.mouseEnabled=true;this.mState="idle";this.mMouseDown=false;this.mPressFunction};TGE.Button.prototype={Setup:function(b,f,e,d,c,a){this.mNumStates=c;TGE.ScreenEntity.prototype.Setup.call(this,b,f,null,a);this.SetImage(e,1,c);this.mPressFunction=d;this.setButtonState("idle");return this},MouseDown:function(){this.mMouseDown=true},MouseOver:function(){},MouseUp:function(){if(this.mPressFunction!=null&&this.mMouseDown){this.mPressFunction.call(this,this)}this.mMouseDown=false},subclassUpdate:function(a){this.mMouseDown=this.mMouseDown&&this.mGame.IsMouseDown();if(this._mMouseOver){this.setButtonState(this.mMouseDown?"down":"hover")}else{this.setButtonState("idle")}},setButtonState:function(b){if(b==this.mState){return}this.mState=b;var a=0;switch(this.mState){case"disable":a=3;break;case"down":a=2;break;case"hover":a=1;break;case"idle":default:a=0;break}if(a<this.mNumStates){this.setSpriteIndex(a)}}};extend(TGE.Button,TGE.ScreenEntity);TGE.Text=function(a){TGE.Text.superclass.constructor.call(this,a);this.text="";this.font="12px Arial";this.hAlign="center";this.vAlign="middle";this.textColor="#000";return this};TGE.Text.prototype={_mPreviousText:null,_mPreviousFont:null,Setup:function(b,h,f,e,d,g,c,a){TGE.ScreenEntity.prototype.Setup.call(this,b,h,null,a);this.text=f;this.font=e;this.hAlign=d;this.vAlign=g;this.textColor=c;return this},_calculateDimensions:function(b){b.save();b.font=this.font;var a=b.measureText(this.text);this.width=a.width;try{var f=this.font.indexOf("px");var c=this.font.substring(0,f);this.height=parseInt(c,10);this.height+=(this.height/4)>>0}catch(d){this.height=30}b.restore()},_drawClass:function(a){if(this.text===null){return}if(this._mPreviousText!==this.text||this._mPreviousFont!==this.font){this._mPreviousText=this.text;this._mPreviousFont=this.font;this._calculateDimensions(a)}a.font=this.font!==null?this.font:"Arial";a.textAlign=this.hAlign!==null?this.hAlign:"center";a.textBaseline=this.vAlign!==null?this.vAlign:"middle";a.fillStyle=this.textColor!==null?this.textColor:"#000";a.fillText(this.text,0,0)}};extend(TGE.Text,TGE.ScreenEntity);TGE.GameWorldEntity=function(a){TGE.ScreenEntity.call(this,a);this.worldPosition=new TGE.Point()};TGE.GameWorldEntity.prototype={_mLockXPosition:false,Setup:function(b,d,c,a){this.mLayer=a;this.SetWorldPosition(b,d);this.setImage(this.mGame.GetImage(c));this.mGame.getLayer(this.mLayer).addChild(this);return this},SetWorldPosition:function(a,b){this.worldPosition.x=a;this.worldPosition.y=b},CullToCamera:function(d,b,a,c){this._mCameraCulling=[d,b,a,c]},WorldPosition:function(){return this.mWorldPosition},LockXPosition:function(){this._mLockXPosition=true},_updateScreenPosition:function(){var a=this._mLockXPosition?this.worldPosition.x:this.mGame.ScreenX(this.worldPosition.x);var b=this.mGame.ScreenY(this.worldPosition.y);this.x=a;this.y=b}};extend(TGE.GameWorldEntity,TGE.ScreenEntity,null);TGE.Screen=function(a){this.mScreenManager=a;this.mBackground=null;this.mUIElements=new Array();this.mDestroyed=false};TGE.Screen.prototype={Setup:function(){},Close:function(){this.mScreenManager.CloseScreen(this.constructor)},Game:function(){return this.mScreenManager.Game()},CreateUIEntity:function(a){var b=this.mScreenManager.CreateUIEntity(a);this.mUIElements.push(b);return b},DisplayNumber:function(l,s,r,j,p,q,e,m){var k=l.toString();var f=24;var h=2;var g=k.length*p;if(e){var d=Math.floor((k.length-1)/3);g+=d*f;g-=d*h}var b=q=="center"?s+g/2+p/2:s+g;b-=p;var a=r;var o=0;for(i=k.length-1;i>=0;i--){if(e&&o==3){b+=h;this.CreateUIEntity(TGE.ScreenEntity).Setup(b,a,"big_digits_comma",m);b-=f;o=0}var n=this.CreateUIEntity(TGE.ScreenEntity).Setup(b,a,null,m);n.SetImage(j,1,10);n.setSpriteIndex(k.charCodeAt(i)-48);b-=p;o++}},FillBackground:function(a){this.mBackground=this.mScreenManager.Game().CreateUIEntity(TGE.ScreenEntity);this.mBackground.Setup(0,0,null,this.mScreenManager.mLayerName);this.mBackground.registrationX=0;this.mBackground.registrationY=0;this.mBackground.width=this.mScreenManager.Game().Width();this.mBackground.height=this.mScreenManager.Game().Height();this.mBackground.backgroundColor=a},Finalize:function(){},ShowAll:function(){for(var a=0;a<this.mUIElements.length;a++){this.mUIElements[a].Show()}},HideAll:function(){for(var a=0;a<this.mUIElements.length;a++){this.mUIElements[a].Hide()}},Update:function(a){},Destroy:function(){if(this.mBackground!=null){this.mBackground.markForRemoval()}for(var a=0;a<this.mUIElements.length;a++){this.mUIElements[a].markForRemoval()}this.mDestroyed=true}};TGE.ScreenManager=function(a){this.mGame=a;this.mLayerName="ScreenManager";this.mScreens=new Array();this.mFadeIn=null;this.mFadeInAlpha=1;this.mFadeInSpeed=1;this.mFadeInColor=null};TGE.ScreenManager.prototype={Initialize:function(b){for(var a in this.mScreens){if(this.mScreens[a]!=null){this.mScreens[a].Destroy();this.mScreens[a]=null}}b.CreateLayer(this.mLayerName);b.CreateLayer("FadeOverlay")},setupFadeIn:function(a,b){this.mFadeInSpeed=b;this.mFadeInColor=a},CreateUIEntity:function(a){return this.mGame.CreateUIEntity(a)},ShowScreen:function(c,a){var b=new c;c.prototype.constructor.apply(b,[this]);this.mScreens[c.name]=b;b.Setup();b.Finalize();a=typeof a==="undefined"?true:a;if(a!=false){this.ResetFade()}return b},CloseScreen:function(b){var a=this.mScreens[b.name];if(a==null){return}a.Destroy();this.mScreens[b]=null},ResetFade:function(){if(this.mFadeInColor!==null){if(this.mFadeIn===null){this.mFadeIn=new TGE.DisplayObject();this.mFadeIn.width=this.mGame.Width();this.mFadeIn.height=this.mGame.Height();this.mFadeIn.registrationX=0;this.mFadeIn.registrationY=0;this.mFadeIn.backgroundColor=this.mFadeInColor;this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn)}if(this.mGame.getLayer("FadeOverlay").getChildIndex(this.mFadeIn)===-1){this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn)}this.mFadeInAlpha=1;this.mFadeIn.alpha=1;this.mFadeIn.visible=true}},Update:function(b){if(this.mFadeIn!==null&&this.mFadeInColor!==null){this.mFadeInAlpha-=b/this.mFadeInSpeed;if(this.mFadeInAlpha<=0){this.mFadeInAlpha=0;this.mFadeIn.visible=false}this.mFadeIn.alpha=this.mFadeInAlpha}for(var a in this.mScreens){if(this.mScreens[a]!=null){this.mScreens[a].Update(b)}}},Game:function(){return this.mGame},XFromPercentage:function(a){return this.mGame.Width()*a},YFromPercentage:function(a){return this.mGame.Height()*a},FixedDistanceFromTop:function(a){return a},FixedDistanceFromBottom:function(a){return this.mGame.Height()-a},FixedDistanceFromLeft:function(a){return a},FixedDistanceFromRight:function(a){return this.mGame.Width()-a}};TGE.Analytics=function(a){this.mGameName=a;return this};TGE.Analytics.prototype={LogGameEvent:function(a,e,b){var d=this.mGameName;if((a=="pause"||a=="resume")&&e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: game, "+a+", "+d;if(a=="load"||a=="end"){c+=(", "+b.toString())}TGE.log(c)},LogShareEvent:function(a,d){var c=this.mGameName;if(d!=null&&d>0){c+=(" - level "+d.toString())}var b="ANALYTIC EVENT: share, "+a+", "+c;TGE.log(b)},LogLevelEvent:function(a,e,b){var d=this.mGameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: level, "+a+", "+d;if((a=="complete"||a=="fail")&&b!=null){c+=(", "+b.toString())}TGE.log(c)},LogAchievementEvent:function(b,e,a){var d=this.mGameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: achievement, "+b+", "+d;if(a!=null){c+=(", "+a.toString())}TGE.log(c)},LogClickThruEvent:function(a,d){var c=this.mGameName;if(d!=null&&d>0){c+=(" - level "+d.toString())}var b="ANALYTIC EVENT: clickthru, "+a+", "+c;TGE.log(b)},LogCustomEvent:function(a,e,b){var d=this.mGameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: custom, "+a+", "+d;if(b!=null){c+=(", "+b.toString())}TGE.log(c)}};TGE.GoogleAnalytics=function(a){TGE.GoogleAnalytics.superclass.constructor.call(this,a);return this};TGE.GoogleAnalytics.prototype={LogGameEvent:function(g,a,j){try{var d=this.mGameName;if((g=="pause"||g=="resume")&&a!=null&&a>0){d+=(" - level "+a.toString())}var k="game";var f=g;var b=d;var c=j;_gaq.push(["_trackEvent",k,f,b,c])}catch(h){TGE.log("GoogleAnalytics game event error: "+h.toString())}},LogShareEvent:function(b,j){try{var g=this.mGameName;if(j!=null&&j>0){g+=(" - level "+j.toString())}var a="share";var f=b;var c=g;var h=null;_gaq.push(["_trackEvent",a,f,c,h])}catch(d){TGE.log("GoogleAnalytics share event error: "+d.toString())}},LogLevelEvent:function(h,a,f){try{var d=this.mGameName;if(a!=null&&a>0){d+=(" - level "+a.toString())}var k="level";var g=h;var b=d;var c;if(h=="complete"||h=="fail"&&f!=null){c=f}_gaq.push(["_trackEvent",k,g,b,c])}catch(j){TGE.log("GoogleAnalytics level event error: "+j.toString())}},LogAchievementEvent:function(d,a,j){try{var f=this.mGameName;if(a!=null&&a>0){f+=(" - level "+a.toString())}var k="achievement";var g=d;var b=f;var c=j;_gaq.push(["_trackEvent",k,g,b,c])}catch(h){TGE.log("GoogleAnalytics achievement event error: "+h.toString())}},LogClickThruEvent:function(b,j){try{var g=this.mGameName;if(j!=null&&j>0){g+=(" - level "+j.toString())}var a="clickthru";var f=b;var c=g;var h=null;_gaq.push(["_trackEvent",a,f,c,h])}catch(d){TGE.log("GoogleAnalytics clickthru event error: "+d.toString())}},LogCustomEvent:function(g,a,j){try{var d=this.mGameName;if(a!=null&&a>0){d+=(" - level "+a.toString())}var k="custom";var f=g;var b=d;var c=j;_gaq.push(["_trackEvent",k,f,b,c])}catch(h){TGE.log("GoogleAnalytics custom event error: "+h.toString())}}};extend(TGE.GoogleAnalytics,TGE.Analytics,null);TGE.ParallaxPane=function(a){TGE.ParallaxPane.superclass.constructor.call(this,a);this.mTrackingSpeed=1;this.mPane1=null;this.mPane2=null;this.mHorizontalOffset=0;this.mWorldY=0};TGE.ParallaxPane.prototype={Setup:function(a,d,c,b){TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,b);this.mWorldY=a;this.registrationX=0;this.registrationY=0;this.mTrackingSpeed=d;this.mPane1=new TGE.Sprite();this.mPane1.setImage(this.mGame.GetImage(c));this.addChild(this.mPane1);this.mPane1.x=0;this.mPane1.y=0;this.mPane1.registrationX=0;this.mPane1.registrationY=0;this.mPane2=new TGE.Sprite();this.mPane2.setImage(this.mGame.GetImage(c));this.addChild(this.mPane2);this.mPane2.x=this.mGame.Width();this.mPane2.y=0;this.mPane2.registrationX=0;this.mPane2.registrationY=0;return this},SetHorizontalOffset:function(a){this.mHorizontalOffset=a},_updateScreenPosition:function(){var c=this.mGame.CameraLocation().x;var a=(-c+this.mHorizontalOffset)*this.mTrackingSpeed/this.scaleX;var b=this.mGame.Width()/this.scaleX;this.mPane1.x=a%b;this.mPane1.y=this.mGame.ScreenY(this.mWorldY);this.mPane2.x=this.mPane1.x+b;this.mPane2.y=this.mGame.ScreenY(this.mWorldY)}};extend(TGE.ParallaxPane,TGE.ScreenEntity);TGE.VerticalParallaxPane=function(a){TGE.VerticalParallaxPane.superclass.constructor.call(this,a);this.mTrackingSpeed=1;this.mPane1=null;this.mPane2=null;this.mVerticalOffset=0};TGE.VerticalParallaxPane.prototype={Setup:function(c,b,a){TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,a);this.registrationX=0;this.registrationY=0;this.mTrackingSpeed=c;this.mPane1=new TGE.Sprite();this.mPane1.setImage(this.mGame.GetImage(b));this.addChild(this.mPane1);this.mPane1.x=0;this.mPane1.y=0;this.mPane1.registrationX=0;this.mPane1.registrationY=0;this.mPane2=new TGE.Sprite();this.mPane2.setImage(this.mGame.GetImage(b));this.addChild(this.mPane2);this.mPane2.x=0;this.mPane2.y=this.mGame.Height();this.mPane2.registrationX=0;this.mPane2.registrationY=0;return this},_updateScreenPosition:function(){var c=this.mGame.CameraLocation().y;var b=(c+this.mVerticalOffset)*this.mTrackingSpeed/this.scaleY;var a=this.mGame.Height()/this.scaleY;this.mPane1.x=0;this.mPane1.y=b%a;this.mPane2.x=0;this.mPane2.y=this.mPane1.y-a}};extend(TGE.VerticalParallaxPane,TGE.ScreenEntity);TGE.Advertisement=function(a){this.element=a.element==="undefined"?null:a.element;this.closeCallback=a.closeCallback==="undefined"?null:a.closeCallback};TGE.Advertisement.prototype={close:function(){if(this.element!==null&&this.element.parentNode!==null){this.element.parentNode.removeChild(this.element)}if(this.closeCallback!==null){this.closeCallback.call()}}};TGE.Advertisement.DisplayAd=function(c){var f=c.parentDiv;var b=c.adWidth;var d=c.adHeight;var a=typeof c.x==="undefined"?(f.clientWidth-b)/2:c.x;var h=typeof c.y==="undefined"?(f.clientHeight-d)/2:c.y;var g=typeof c.closeCallback==="undefined"?null:c.closeCallback;var e=null;if(TGE.BrowserDetect.platform==="Android"&&TGE.BrowserDetect.browser==="Mozilla"&&TGE.BrowserDetect.OSversion==="4.0"){e=null}else{e=document.createElement("div");e.style.position="absolute";e.style.zIndex=3;e.style.left=a.toString()+"px";e.style.top=h.toString()+"px";e.style.width=b.toString()+"px";e.style.height=d.toString()+"px";e.style.overflow="hidden";e.style.border="none";f.insertBefore(e,f.firstChild);e.innerHTML="<object type='text/html' width='"+b+"px' height='"+(d+4).toString()+"px' data='"+c.adURL+"'></object>"}return new TGE.Advertisement({element:e,closeCallback:g})};TGE.Advertisement.DisplayModalOverlayAd=function(e){var f=e.parentDiv;var q=e.adWidth;var s=e.adHeight;var g=typeof e.skipDelay==="undefined"?0:e.skipDelay;var h=typeof e.headerText==="undefined"?"This game sponsored by:":e.headerText;var j=typeof e.overlayRed==="undefined"?1:e.overlayRed;var t=typeof e.overlayGreen==="undefined"?1:e.overlayGreen;var p=typeof e.overlayBlue==="undefined"?1:e.overlayBlue;var o=typeof e.overlayOpacity==="undefined"?1:e.overlayOpacity;var d=typeof e.closeCallback==="undefined"?null:e.closeCallback;if(TGE.BrowserDetect.platform==="Android"&&TGE.BrowserDetect.browser==="Mozilla"&&TGE.BrowserDetect.OSversion==="4.0"){if(d!==null){d.call()}return}var m=document.createElement("div");m.id="ad_overlay";m.style.zIndex=3;m.style.position="absolute";m.style.width=f.clientWidth+"px";m.style.height=f.clientHeight+"px";m.style.backgroundColor="rgba("+Math.round(j*255).toString()+","+Math.round(t*255).toString()+","+Math.round(p*255).toString()+","+o.toString()+")";f.insertBefore(m,f.firstChild);var r=null;if(typeof e.closeButton==="string"){var b=30;r=document.createElement("div");r.id="tge_ad_close_button";r.style.position="absolute";r.style.display="none";var k=Math.round(f.clientWidth*0.0156);var c=f.clientWidth-k-b;r.style.top=k.toString()+"px";r.style.left=c.toString()+"px";r.innerHTML="<img src='"+e.closeButton+"'>";r.style.cursor="pointer";m.insertBefore(r,m.firstChild)}var b=30;var n=document.createElement("div");n.id="tge_ad_resume_button";n.style.position="absolute";n.style.display="none";var k=Math.round(f.clientHeight*0.904);var c=(f.clientWidth-(300+2))/2;n.style.top=k.toString()+"px";n.style.left=c.toString()+"px";n.style.width="300px";n.style.marginLeft="auto";n.style.marginRight="auto";n.style.textAlign="center";n.style.paddingTop="6px";n.style.paddingBottom="6px";n.style.backgroundColor="#f00";n.style.border="solid 1px #444";n.style.borderRadius="5px";n.style.color="#fff";n.style.fontSize="17px";n.style.fontWeight="bold";n.innerHTML="Resume Game Play";n.style.cursor="pointer";m.insertBefore(n,m.firstChild);var a=TGE.BrowserDetect.isMobileDevice?"touchstart":"click";if(r!==null){r.addEventListener(a,TGE.Advertisement._CloseAd.bind(this,m,d),false)}n.addEventListener(a,TGE.Advertisement._CloseAd.bind(this,m,d),false);if(g>0){setTimeout(TGE.Advertisement._ShowOverlayCloseButtons.bind(this,m),g*1000)}else{TGE.Advertisement._ShowOverlayCloseButtons(m)}m.addEventListener("click",TGE.Advertisement._BlockEvent,false);m.addEventListener("mousedown",TGE.Advertisement._BlockEvent,false);m.addEventListener("mouseup",TGE.Advertisement._BlockEvent,false);m.addEventListener("mousemove",TGE.Advertisement._BlockEvent,false);var l=document.createElement("div");l.id="ad_div";l.style.position="absolute";var k=(f.clientHeight-(s+70))/2;l.style.top=k.toString()+"px";l.style.marginLeft="auto";l.style.marginRight="auto";l.style.width="100%";l.style.overflow="hidden";l.style.color="#333";l.style.fontSize="20px";l.style.fontWeight="bold";l.style.textAlign="center";m.insertBefore(l,m.firstChild);l.innerHTML="<div style='padding-bottom: 15px;'>"+h+"</div><object type='text/html' width='"+q+"px' height='"+(s+4).toString()+"px' data='"+e.adURL+"'></object><div style='color: #666; font-size: 10px; font-weight: normal; padding-left: "+(q-72).toString()+"px;'>Advertisement</div>"};TGE.Advertisement._CloseAd=function(a,c,b){a.parentNode.removeChild(a);if(c!==null){c.call()}};TGE.Advertisement._ShowOverlayCloseButtons=function(b){var a=document.getElementById("tge_ad_close_button");if(a!=null){a.style.display="block"}var c=document.getElementById("tge_ad_resume_button");if(c!=null){c.style.display="block"}};TGE.Advertisement._BlockEvent=function(a){a.stopPropagation();a.preventDefault();a.stopImmediatePropagation();return false};TGE.PlatformCompatibility=function(){return this};TGE.PlatformCompatibility.prototype={isAudioSupported:function(){var b=document.createElement("audio"),a=false;try{if(a=!!b.canPlayType){a=new Boolean(a);a.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");a.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,"");a.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");a.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(c){}return a},isAudioFormatSupported:function(a){var d=document.createElement("audio"),b=false;var c;try{if(b=!!d.canPlayType){b=new Boolean(b);switch(a){case"ogg":c=d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");break;case"mp3":c=d.canPlayType("audio/mpeg;").replace(/^no$/,"");break;case"wav":c=d.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");break;case"m4a":c=(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,"");break;default:break}}}catch(f){}return c},isCanvasSupported:function(){var a=document.createElement("canvas");return !!(a.getContext&&a.getContext("2d"))},isVideoSupported:function(){var b=document.createElement("video"),a=false;try{if(a=!!b.canPlayType){a=new Boolean(a);a.ogg=b.canPlayType('video/ogg; codecs="theora"');a.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"');a.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"')}}catch(c){}return a},isDragAndDropSupported:function(){var a=document.createElement("div");bool=("draggable" in a)||("ondragstart" in a&&"ondrop" in a);return bool},isGeolocationSupported:function(){return !!navigator.geolocation},isWebGlSupported:function(){try{var b=document.createElement("canvas"),a;a=!!(window.WebGLRenderingContext&&(b.getContext("experimental-webgl")||b.getContext("webgl")));b=undefined}catch(c){a=false}return a},isHistorySupported:function(){return !!(window.history&&history.pushState)},isVideoSupported:function(){var b=document.createElement("video"),a=false},isLocalStorageSupported:function(){try{localStorage.setItem(mod,mod);localStorage.removeItem(mod);return true}catch(a){return false}},isSessionStorageSupported:function(){try{sessionStorage.setItem(mod,mod);sessionStorage.removeItem(mod);return true}catch(a){return false}},isSVGSupported:function(){ns={svg:"http://www.w3.org/2000/svg"};return !!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect}};TGE.DeviceOrientation=function(){return this};TGE.DeviceOrientation.prototype={orientationChangeCallBack:null,RegisterOrientationChange:function(a){TGE.DeviceOrientation.prototype.orientationChangeCallBack=a;window.addEventListener("orientationchange",TGE.DeviceOrientation.prototype.internalOrientationChanged);TGE.DeviceOrientation.prototype.internalOrientationChanged()},internalOrientationChanged:function(){if(window.orientation===90||window.orientation===-90){TGE.DeviceOrientation.prototype.orientationChangeCallBack("landscape")}else{TGE.DeviceOrientation.prototype.orientationChangeCallBack("portrait")}}};